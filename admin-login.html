<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì ë¡œê·¸ì¸ â€” KASG LMS</title>
<link rel="stylesheet" href="css/main.css">
<style>
body{background:linear-gradient(135deg,#050D1F 0%,#0C1F3F 65%,#0A1530 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}
.al-wrap{width:420px;max-width:96vw}
.al-card{background:#fff;border-radius:var(--radius-lg);border-top:5px solid var(--kasg-red);box-shadow:0 32px 80px rgba(0,0,0,.6);overflow:hidden;animation:cardIn .4s ease}
@keyframes cardIn{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:none}}
.al-head{background:var(--navy);padding:24px 34px 20px;text-align:center}
.al-head img{height:36px;margin:0 auto 10px;display:block}
.al-head-title{font-family:'Noto Serif KR',serif;font-size:16px;font-weight:700;color:#fff;margin-bottom:3px}
.al-head-sub{font-size:9.5px;color:var(--kasg-gold);letter-spacing:1.5px;text-transform:uppercase;opacity:.7}

/* ì—­í•  íƒ­ */
.role-tabs{display:flex;margin:0;border-bottom:3px solid var(--kasg-gold)}
.role-tab{flex:1;padding:11px 8px;font-size:12.5px;font-weight:700;cursor:pointer;border:none;background:rgba(255,255,255,.05);color:rgba(255,255,255,.45);transition:all .18s;letter-spacing:.3px}
.role-tab.active{background:var(--navy);color:#fff;position:relative}
.role-tab.active::after{content:'';position:absolute;bottom:-3px;left:0;right:0;height:3px;background:var(--kasg-gold)}
.role-tab:hover:not(.active){background:rgba(255,255,255,.1);color:rgba(255,255,255,.75)}

.al-body{padding:24px 32px 28px}
.err-box{background:#FEE2E2;color:var(--error);padding:10px 13px;border-radius:var(--radius);font-size:13px;margin-bottom:14px;border-left:3px solid var(--error);display:none}
.err-box.show{display:block}

.role-hint{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:var(--radius);margin-bottom:14px;font-size:12px}
.role-hint.super{background:rgba(200,48,42,.07);color:#8B1818;border:1px solid rgba(200,48,42,.15)}
.role-hint.org{background:rgba(12,31,63,.06);color:var(--navy);border:1px solid rgba(12,31,63,.12)}

.back-link{text-align:center;margin-top:16px;font-size:12px;color:var(--text-light);cursor:pointer}
.back-link:hover{color:var(--navy)}
</style>
</head>
<body>
<div class="al-wrap">
  <div class="al-card">
    <div class="al-head">
      <img src="assets/logo-wide.png" alt="KASG">
      <div class="al-head-title">ê´€ë¦¬ì í¬í„¸</div>
      <div class="al-head-sub">ADMINISTRATOR PORTAL</div>
    </div>

    <!-- ì—­í•  íƒ­ (í—¤ë” í•˜ë‹¨) -->
    <div class="role-tabs" style="background:var(--navy)">
      <div class="role-tab active" id="tab-super" onclick="setRole('super')">ğŸ”‘ ì‹œìŠ¤í…œ ê´€ë¦¬ì</div>
      <div class="role-tab" id="tab-org" onclick="setRole('org')">ğŸ¢ íšŒì‚¬ë³„ ê´€ë¦¬ì</div>
    </div>

    <div class="al-body">
      <div class="err-box" id="err"></div>

      <!-- ì‹œìŠ¤í…œ ê´€ë¦¬ì í¼ -->
      <div id="form-super">
        <div class="role-hint super">âš¡ ìµœê³  ê¶Œí•œ â€” ëª¨ë“  ë©”ë‰´ì™€ ë°ì´í„°ì— ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
        <div class="form-group">
          <label class="form-label">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
          <input class="form-input" type="password" id="super-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        </div>
        <button class="btn btn-danger btn-lg btn-block" onclick="loginSuper()">ë¡œê·¸ì¸</button>
      </div>

      <!-- íšŒì‚¬ë³„ ê´€ë¦¬ì í¼ -->
      <div id="form-org" style="display:none">
        <div class="role-hint org">ğŸ¢ ì†Œì† íšŒì‚¬ ë°ì´í„°ë§Œ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìë¡œë¶€í„° ê³„ì •ì„ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.</div>
        <div class="form-group">
          <label class="form-label">ì•„ì´ë””</label>
          <input class="form-input" type="text" id="org-id" placeholder="ë¶€ì—¬ë°›ì€ ê´€ë¦¬ì ì•„ì´ë””">
        </div>
        <div class="form-group">
          <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input class="form-input" type="password" id="org-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        </div>
        <button class="btn btn-primary btn-lg btn-block" onclick="loginOrg()">ë¡œê·¸ì¸</button>
      </div>

      <div class="back-link" onclick="window.location.href='index.html'">â† ìˆ˜ê°•ìƒ ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</div>
    </div>
  </div>
</div>

<script type="module">
import { DB } from './js/firebase-config.js';

window.setRole = function(role) {
  ['super','org'].forEach(r => {
    document.getElementById(`tab-${r}`).classList.toggle('active', r === role);
    document.getElementById(`form-${r}`).style.display = r === role ? '' : 'none';
  });
  document.getElementById('err').classList.remove('show');
};

function showErr(msg) {
  const e = document.getElementById('err');
  e.textContent = msg;
  e.classList.add('show');
}

window.loginSuper = async function() {
  const pw = document.getElementById('super-pw').value;
  if (!pw) { showErr('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  const stored = await DB.get('admin/password') || 'kasg2025admin';
  if (pw === stored) {
    sessionStorage.setItem('kasg_admin', JSON.stringify({ ok:true, role:'super', id:'admin' }));
    window.location.href = 'admin.html';
  } else {
    showErr('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
};

window.loginOrg = async function() {
  const id = document.getElementById('org-id').value.trim();
  const pw = document.getElementById('org-pw').value;
  if (!id || !pw) { showErr('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  const safeKey = id.replace(/[.#$[\] ]/g, '_');
  const admin = await DB.get(`orgAdmins/${safeKey}`);
  if (!admin)          { showErr('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.'); return; }
  if (admin.password !== pw) { showErr('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  if (admin.disabled)  { showErr('ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.'); return; }
  sessionStorage.setItem('kasg_admin', JSON.stringify({
    ok: true, role: 'org', id: safeKey,
    name: admin.name, org: admin.org,
    permissions: admin.permissions || []
  }));
  window.location.href = 'admin.html';
};

document.addEventListener('keydown', e => {
  if (e.key !== 'Enter') return;
  const isSuper = document.getElementById('form-super').style.display !== 'none';
  isSuper ? loginSuper() : loginOrg();
});

// ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ë°”ë¡œ ì´ë™
try {
  const s = sessionStorage.getItem('kasg_admin');
  if (s && JSON.parse(s).ok) window.location.href = 'admin.html';
} catch(e) {}
</script>
</body>
</html>
